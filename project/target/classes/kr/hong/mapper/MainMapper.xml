<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.hong.mapper.MainMapper">
	
	<insert id="join" parameterType="kr.hong.domain.User">
    	insert into tbl_user(user_id, user_pw, user_name, user_birthdate, user_nationality, user_joindate, admin_yn, user_status) 
      	values (#{user_id}, #{user_pw}, #{user_name}, now(), #{user_nationality}, now(), 'n', 'n')
	</insert>
	<select id="login" parameterType="kr.hong.domain.User" resultType="kr.hong.domain.User">
	    select * from tbl_user where user_id = #{login_user_id} and user_pw = #{login_user_pw}
	</select>
	
	<select id="WordList1" resultType="kr.hong.domain.Word">
	    select * from tbl_word where level = 1 order by study_date asc
	</select>
	
	<!-- 신규 -->
	<select id="SylList" resultType="kr.hong.domain.Syllable">
	    select * from tbl_syllable order by study_date asc
	</select>
		<select id="WordList" resultType="kr.hong.domain.Word">
	    select * from tbl_word order by study_date asc
	</select>
		<select id="SenList" resultType="kr.hong.domain.Sentence">
	    select * from tbl_sentence order by study_date asc
	</select>
		<select id="studypage2_sy" parameterType="String" resultType="kr.hong.domain.Syllable">
	    select * from tbl_syllable where study_date = #{day}
	</select>
		<select id="studypage2_wo" parameterType="String" resultType="kr.hong.domain.Word">
	    select * from tbl_word where study_date = #{day}
	</select>
		<select id="studypage2_sen" parameterType="String" resultType="kr.hong.domain.Sentence">
	    select * from tbl_sentence where study_date = #{day}
	</select>
	<!-- 마이페이지 STEP 불러오기 -->
	<select id="mypage1_sy" parameterType="String" resultType="kr.hong.domain.Mypage">
		SELECT s.study_date, AVG((t.speak_accuracy+t.lip_accuracy)/2) AS accuracy
		FROM tbl_syllable AS s
		JOIN tbl_syllable_test AS t
		ON t.num = s.num
		WHERE t.user_id = #{id}
		group by s.study_date
		having COUNT(*)=5
		order by s.study_date;
	</select>
	<select id="mypage1_wo" parameterType="String" resultType="kr.hong.domain.Mypage">
		SELECT w.study_date, AVG((t.speak_accuracy+t.lip_accuracy)/2) AS accuracy
		FROM tbl_word AS w
		JOIN tbl_word_test AS t
		ON t.num = w.num
		WHERE t.user_id = #{id}
		group by w.study_date
		having COUNT(*)=5
		order by w.study_date;
	</select>
	<select id="mypage1_se" parameterType="String" resultType="kr.hong.domain.Mypage">
		SELECT s.study_date, AVG((t.speak_accuracy+t.lip_accuracy)/2) AS accuracy
		FROM tbl_sentence AS s
		JOIN tbl_sentence_test AS t
		ON t.num = s.num
		WHERE t.user_id = #{id}
		group by s.study_date
		having COUNT(*)=5
		order by s.study_date;
	</select>
	
	<select id="Syl_weak" parameterType="String" resultType="kr.hong.domain.Test">
	    SELECT s.content, t.accuracy, t.weak
	    FROM tbl_syllable AS s
		JOIN tbl_syllable_test AS t
		ON t.num = s.num
		WHERE t.user_id = #{id}
		order by s.study_date;
	</select>
	<!-- STEP선택 시 전 STEP, 선택 STEP에 해당하는 5개 단어의 정확도 불러오기 -->
	<select id="mypage1_step_sy1" parameterType="String" resultType="kr.hong.domain.Test">
	    SELECT s.num, s.content, s.study_date, SUM(t.speak_accuracy+t.lip_accuracy)/2 AS accuracy
		FROM tbl_syllable AS s
		JOIN tbl_syllable_test AS t
		ON s.num = t.num
		WHERE t.user_id = #{id} AND study_date = #{step}-1
		GROUP BY s.num
		order by s.study_date;
	</select>
	<select id="mypage1_step_sy2" parameterType="String" resultType="kr.hong.domain.Test">
	    SELECT s.num, s.content, s.study_date, SUM(t.speak_accuracy+t.lip_accuracy)/2 AS accuracy
		FROM tbl_syllable AS s
		JOIN tbl_syllable_test AS t
		ON s.num = t.num
		WHERE t.user_id = #{id} AND study_date = #{step}
		GROUP BY s.num
		order by s.study_date;
	</select>
	<select id="mypage2_step_wo1" parameterType="String" resultType="kr.hong.domain.Test">
	    SELECT w.num, w.content, w.study_date, SUM(t.speak_accuracy+t.lip_accuracy)/2 AS accuracy
		FROM tbl_word AS w
		JOIN tbl_word_test AS t
		ON w.num = t.num
		WHERE t.user_id = #{id} AND study_date = #{step}-1
		GROUP BY w.num
		order by w.study_date;
	</select>
	<select id="mypage2_step_wo2" parameterType="String" resultType="kr.hong.domain.Test">
	    SELECT w.num, w.content, w.study_date, SUM(t.speak_accuracy+t.lip_accuracy)/2 AS accuracy
		FROM tbl_word AS w
		JOIN tbl_word_test AS t
		ON w.num = t.num
		WHERE t.user_id = #{id} AND study_date = #{step}
		GROUP BY w.num
		order by w.study_date;
	</select>
	<select id="mypage3_step_se1" parameterType="String" resultType="kr.hong.domain.Test">
	    SELECT s.num, s.content, s.study_date, SUM(t.speak_accuracy+t.lip_accuracy)/2 AS accuracy
		FROM tbl_sentence AS s
		JOIN tbl_sentence_test AS t
		ON s.num = t.num
		WHERE t.user_id = #{id} AND study_date = #{step}-1
		GROUP BY s.num
		order by s.study_date;
	</select>
	<select id="mypage3_step_se2" parameterType="String" resultType="kr.hong.domain.Test">
	    SELECT s.num, s.content, s.study_date, SUM(t.speak_accuracy+t.lip_accuracy)/2 AS accuracy
		FROM tbl_sentence AS s
		JOIN tbl_sentence_test AS t
		ON s.num = t.num
		WHERE t.user_id = #{id} AND study_date = #{step}
		GROUP BY s.num
		order by s.study_date;
	</select>
	<select id="speak_acc_sy1" parameterType="String" resultType="int">
	   	SELECT COUNT(num)
		FROM tbl_syllable_test
		WHERE user_id = #{id}
	</select>
	<select id="speak_acc_sy2" parameterType="String" resultType="int">
	    SELECT COUNT(num)
		FROM tbl_syllable_test
		WHERE user_id = #{id} AND weak = 'y'
	</select>

	<select id="Word_weak" parameterType="String" resultType="kr.hong.domain.Test">
	    SELECT s.content, t.accuracy, t.weak
	    FROM tbl_word AS s
		JOIN tbl_word_test AS t
		ON t.num = s.num
		WHERE t.user_id = #{id}
		order by s.study_date;
	</select>
	
	<select id="Sen_weak" parameterType="String" resultType="kr.hong.domain.Test">
	    SELECT s.content, t.accuracy, t.weak
	    FROM tbl_sentence AS s
		JOIN tbl_sentence_test AS t
		ON t.num = s.num
		WHERE t.user_id = #{id}
		order by s.study_date;
	</select>

	
	
</mapper> 